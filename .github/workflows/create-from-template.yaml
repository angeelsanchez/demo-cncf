name: Create Repo from Template

on:
  workflow_dispatch:
    inputs:
      repo_name:
        description: 'Name for the new repository'
        required: true
        type: string

jobs:
  create:
    runs-on: ubuntu-latest
    steps:
      - name: Create repo from template
        env:
          GH_TOKEN: ${{ secrets.REPO_TOKEN }}
        run: |
          REPO_NAME="${{ inputs.repo_name }}"
          echo "Creating repo: $REPO_NAME"

          gh api repos/${{ github.repository }}/generate \
            -X POST \
            -f owner=${{ github.repository_owner }} \
            -f name="$REPO_NAME" \
            -f description="Landing page for Cloud Native Latam Summit" \
            -F private=false \
            -F include_all_branches=false

          echo "Repo created: https://github.com/${{ github.repository_owner }}/$REPO_NAME"

      - name: Trigger build workflow
        env:
          GH_TOKEN: ${{ secrets.REPO_TOKEN }}
        run: |
          REPO_NAME="${{ inputs.repo_name }}"
          sleep 5
          gh api repos/${{ github.repository_owner }}/$REPO_NAME/dispatches \
            -X POST \
            -f event_type=build || true
